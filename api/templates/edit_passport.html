<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 720px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        h2 {
            margin-top: 30px;
            color: #333;
            font-size: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        label {
            display: inline-flex;      /* –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É */
            align-items: center; 
            margin-top: 15px;
            font-weight: bold;
            color: #444;
            gap: 6px;                   /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —á–µ–∫–±–æ–∫—Å–æ–º –∏ —Ç–µ–∫—Å—Ç–æ–º */
            cursor: pointer;            /* –∫—É—Ä—Å–æ—Ä –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            white-space: nowrap;  
        }

        label input[type="checkbox"] {
            display: block;
            margin: 0; /* —É–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –±—Ä–∞—É–∑–µ—Ä–∞ */
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 6px;
            transition: border-color 0.2s;
        }

        input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        button {
            margin-top: 30px;
            width: 100%;
            background-color: #4CAF50;
            color: white;
            padding: 14px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 17px;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #45a049;
        }

        @media (max-width: 600px) {
            label {
                font-size: 15px;
            }

            input {
                font-size: 15px;
            }

            h1 {
                font-size: 22px;
            }

            h2 {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h1>

        <form id="passportForm">
            <div>
                <div>
                    <h2>üìÑ –†–∏–µ–ª—Ç–æ—Ä</h2>
                
                    <div>
                        <label for="rieltor_business_type">–û—Ç –∫–∞–∫–æ–≥–æ –ª–∏—Ü–∞ –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä</label>
                        <select id="rieltor_business_type" name="rieltor_business_type" required>
                            <option value="" disabled selected>‚Äî –Ω–µ –≤—ã–±—Ä–∞–Ω–æ ‚Äî</option>
                            {% if doc_type == "1" %}
                                <option value="–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ">–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ</option>
                                <option value="–ò–ü">–ò–ü</option>
                            {% else %}
                                <option value="–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ">–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ</option>
                                <option value="–ò–ü">–ò–ü</option>
                                <option value="–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π">–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π</option>
                            {% endif %}
                        </select>
                    </div>
                    
                    <!-- –§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ -->
                    <div class="individual-fields" style="display:none;">
                        <p style="color:red; font-weight:bold;">
                            –í–Ω–∏–º–∞–Ω–∏–µ! –ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å–∫–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –º–æ–∂–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–æ–º! 
                            –î–∞–Ω–Ω—ã–π –±–ª–∞–Ω–∫ –¥–æ–≥–æ–≤–æ—Ä–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. 
                            –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–π –∏ —à—Ç—Ä–∞—Ñ–æ–≤ –æ—Ç –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—è –ª–∏–±–æ —Å–∞–º–æ–∑–∞–Ω—è—Ç–æ–≥–æ. 
                            –ü—Ä–æ–π—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –º–æ–∂–Ω–æ —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏.
                        </p>
                        <label>
                            <input type="checkbox" id="consent_checkbox">
                            –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é, —á—Ç–æ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
                        </label>
                
                        <!-- –§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ -->
                        <div id="individual-data" style="display:none; margin-top:10px;">
                            <label>–§–∞–º–∏–ª–∏—è</label>
                            <input type="text" name="rieltor_last_name" value="{{rieltor_last_name}}">
                            <label>–ò–º—è</label>
                            <input type="text" name="rieltor_first_name" value="{{rieltor_first_name}}">
                            <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                            <input type="text" name="rieltor_middle_name" value="{{rieltor_middle_name}}">
                            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                            <input type="text" name="rieltor_birth_date" value="{{rieltor_birth_date}}">
                            <label>–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                            <input type="text" name="rieltor_passport_series" value="{{rieltor_passport_series}}">
                            <label>–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                            <input type="text" name="rieltor_passport_number" value="{{rieltor_passport_number}}">
                            <label>–ö–µ–º –≤—ã–¥–∞–Ω</label>
                            <input type="text" name="rieltor_issued_by" value="{{rieltor_issued_by}}">
                            <label>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</label>
                            <input type="text" name="rieltor_issue_date" value="{{rieltor_issue_date}}">
                            <label>–ê–¥—Ä–µ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</label>
                            <input type="text" name="rieltor_registration_address" value="{{rieltor_registration_address}}">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" name="rieltor_phone" pattern="\+?[0-9\s\-]{7,15}" placeholder="+7 999 123-45-67">
                            <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                            <input type="email" name="rieltor_email" value="{{rieltor_email}}">
                        </div>
                    </div>
                
                    <!-- –ò–ü -->
                    <div class="individual-entrepreneur-fields" style="display:none; margin-top:10px;">
                        <label>–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" name="rieltor_last_name" value="{{rieltor_last_name}}">
                        <label>–ò–º—è</label>
                        <input type="text" name="rieltor_first_name" value="{{rieltor_first_name}}">
                        <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                        <input type="text" name="rieltor_middle_name" value="{{rieltor_middle_name}}">
                        <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                        <input type="text" name="rieltor_birth_date" value="{{rieltor_birth_date}}">
                        <label>–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                        <input type="text" name="rieltor_passport_series" value="{{rieltor_passport_series}}">
                        <label>–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                        <input type="text" name="rieltor_passport_number" value="{{rieltor_passport_number}}">
                        <label>–ö–µ–º –≤—ã–¥–∞–Ω</label>
                        <input type="text" name="rieltor_issued_by" value="{{rieltor_issued_by}}">
                        <label>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</label>
                        <input type="text" name="rieltor_issue_date" value="{{rieltor_issue_date}}">
                        <label>–ò–ù–ù</label>
                        <input type="text" name="rieltor_INN" value="{{rieltor_INN}}">
                        <label>–û–ì–†–ù–ò–ü</label>
                        <input type="text" name="rieltor_OGRNIP" value="{{rieltor_OGRNIP}}">
                        <label>–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</label>
                        <input type="text" name="rieltor_registration_address" value="{{rieltor_registration_address}}">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞</label>
                        <input type="text" name="rieltor_bank_name" value="{{rieltor_bank_name}}">
                        <label>–†/–°</label>
                        <input type="text" name="rieltor_main_order" value="{{rieltor_main_order}}">
                        <label>–ö/–°</label>
                        <input type="text" name="rieltor_additional_order" value="{{rieltor_additional_order}}">
                        <label>–ë–ò–ö</label>
                        <input type="text" name="rieltor_BIK" value="{{rieltor_BIK}}">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" name="rieltor_phone" pattern="\+?[0-9\s\-]{7,15}" placeholder="+7 999 123-45-67">
                        <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                        <input type="email" name="rieltor_email" value="{{rieltor_email}}">
                    </div>
                
                    <!-- –°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π -->
                    <div class="self-employed-fields" style="display:none; margin-top:10px;">
                        <label>–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" name="rieltor_last_name" value="{{rieltor_last_name}}">
                        <label>–ò–º—è</label>
                        <input type="text" name="rieltor_first_name" value="{{rieltor_first_name}}">
                        <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                        <input type="text" name="rieltor_middle_name" value="{{rieltor_middle_name}}">
                        <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                        <input type="text" name="rieltor_birth_date" value="{{rieltor_birth_date}}">
                        <label>–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                        <input type="text" name="rieltor_passport_series" value="{{rieltor_passport_series}}">
                        <label>–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                        <input type="text" name="rieltor_passport_number" value="{{rieltor_passport_number}}">
                        <label>–ö–µ–º –≤—ã–¥–∞–Ω</label>
                        <input type="text" name="rieltor_issued_by" value="{{rieltor_issued_by}}">
                        <label>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</label>
                        <input type="text" name="rieltor_issue_date" value="{{rieltor_issue_date}}">
                        <label>–ê–¥—Ä–µ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</label>
                        <input type="text" name="rieltor_registration_address" value="{{rieltor_registration_address}}">
                        <label>–ò–ù–ù</label>
                        <input type="text" name="rieltor_INN" value="{{rieltor_INN}}">
                        <label>–†/–°</label>
                        <input type="text" name="rieltor_main_order" value="{{rieltor_main_order}}">
                        <label>–ö/–°</label>
                        <input type="text" name="rieltor_additional_order" value="{{rieltor_additional_order}}">
                        <label>–ë–ò–ö</label>
                        <input type="text" name="rieltor_BIK" value="{{rieltor_BIK}}">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" name="rieltor_phone" pattern="\+?[0-9\s\-]{7,15}" placeholder="+7 999 123-45-67">
                        <label>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                        <input type="email" name="rieltor_email" value="{{rieltor_email}}">
                    </div>
                </div>
                
                <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const consentCheckbox = document.getElementById("consent_checkbox");
                    const individualData = document.getElementById("individual-data");
                
                    consentCheckbox.addEventListener("change", function() {
                        individualData.style.display = this.checked ? "block" : "none";
                    });
                
                    function toggleFields() {
                        const type = document.getElementById('rieltor_business_type').value;
                        const indFields = document.querySelector('.individual-fields');
                        const ipFields = document.querySelector('.individual-entrepreneur-fields');
                        const szFields = document.querySelector('.self-employed-fields');
                
                        indFields.style.display = (type === '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ') ? 'block' : 'none';
                        ipFields.style.display = (type === '–ò–ü') ? 'block' : 'none';
                        szFields.style.display = (type === '–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π') ? 'block' : 'none';
                
                        // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ–∫–±–æ–∫—Å –∏ —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è –¥–ª—è —Ñ–∏–∑. –ª–∏—Ü–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞
                        if (type !== '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ') {
                            consentCheckbox.checked = false;
                            individualData.style.display = "none";
                        }
                    }
                
                    document.getElementById('rieltor_business_type').addEventListener('change', toggleFields);
                    toggleFields(); // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                });
                </script>
                
            </div>

            <div id="client-block">
                <h2>üìÑ –ö–ª–∏–µ–Ω—Ç</h2>
                <label>–§–∞–º–∏–ª–∏—è</label>
                <input type="text" name="client_last_name" value="{{client_last_name}}">
                <label>–ò–º—è</label>
                <input type="text" name="client_first_name" value="{{client_first_name}}">
                <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                <input type="text" name="client_middle_name" value="{{client_middle_name}}">
                <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                <input type="text" name="client_birth_date" value="{{client_birth_date}}">
                <label>–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                <input type="text" name="client_passport_series" value="{{client_passport_series}}">
                <label>–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                <input type="text" name="client_passport_number" value="{{client_passport_number}}">
                <label>–ö–µ–º –≤—ã–¥–∞–Ω</label>
                <input type="text" name="client_issued_by" value="{{client_issued_by}}">
                <label>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</label>
                <input type="text" name="client_issue_date" value="{{client_issue_date}}">
                <label>–ê–¥—Ä–µ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</label>
                <input type="text" name="client_registration_address" value="{{client_registration_address}}">
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç doc_type -->
            {% set templates_map = {
                "2": "docs/lease_agreement.html",
                "3": "docs/mortgage_agreement.html",
                "4": "docs/exchange_agreement.html",
                "6": "docs/selection_agreement.html",
                "7": "docs/sale_agreement.html"
            } %}

            
            {% set tpl = templates_map.get(doc_type) %}
            {% if tpl %}
                {% include tpl %}
            {% else %}
                <p>–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ {{doc_type}}</p>
            {% endif %}

            <input type="hidden" name="user_id" value="{{user_id}}">
            <input type="hidden" name="token" value="{{token}}">

            <button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </form>
    </div>

    <script>
        document.getElementById('passportForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const payload = { Signal: 1 };
        
            // 1. –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ "–†–∏–µ–ª—Ç–æ—Ä–∞"
            const type = document.getElementById('rieltor_business_type').value;
            payload["rieltor_business_type"] = type;

            let activeBlock;
            if (type === '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ') {
                activeBlock = document.querySelector('.individual-fields');
            } else if (type === '–ò–ü') {
                activeBlock = document.querySelector('.individual-entrepreneur-fields');
            } else if (type === '–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π') {
                activeBlock = document.querySelector('.self-employed-fields');
            }
        
            if (activeBlock) {
                const rFields = activeBlock.querySelectorAll('input, select, textarea');
                rFields.forEach(field => {
                    if (field.name && !field.disabled) {
                        payload[field.name] = field.value;
                    }
                });
            }
        
            // 2. –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ "–ö–ª–∏–µ–Ω—Ç–∞" (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–µ)
            const clientFields = document.querySelectorAll('#client-block input, #client-block select, #client-block textarea');
            clientFields.forEach(field => {
                if (field.name) payload[field.name] = field.value;
            });
        
            // 3. –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã (user_id, token)
            const hiddenFields = form.querySelectorAll('input[type="hidden"]');
            hiddenFields.forEach(field => {
                if (field.name) payload[field.name] = field.value;
            });
        
            try {
                const res = await fetch('/api/save_passport_data1', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
        
                const result = await res.json();
                if (result.success) {
                    alert('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –°–µ–π—á–∞—Å –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ' + result.error);
                }
            } catch (err) {
                alert('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + err.message);
            }
        });
        </script>
        

</body>
</html>