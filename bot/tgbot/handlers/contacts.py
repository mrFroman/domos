from aiogram import Dispatcher
from aiogram.types import CallbackQuery

from bot.tgbot.keyboards.inline import *
from bot.tgbot.databases.pay_db import *


async def contacts_inline(cb: CallbackQuery):
    username = cb.from_user.username
    if username == None:
        await cb.message.edit_text('''
–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
–ö–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å:
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –ò–∑–º. (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è @username –≤–æ–π–¥–∏—Ç–µ –≤ –±–æ—Ç –ø–æ —Å—Å—ã–ª–∫–µ –µ—â–µ —Ä–∞–∑ –∏ –Ω–∞–∂–º–∏—Ç–µ /start
''')
    else:
        await cb.message.edit_text('<b>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç:</b>', reply_markup=genRieltorsList())


async def showcontact_inline(cb: CallbackQuery):
    username = cb.from_user.username
    if username == None:
        await cb.message.edit_text('''
–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
–ö–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å:
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –ò–∑–º. (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è @username –≤–æ–π–¥–∏—Ç–µ –≤ –±–æ—Ç –ø–æ —Å—Å—ã–ª–∫–µ –µ—â–µ —Ä–∞–∑ –∏ –Ω–∞–∂–º–∏—Ç–µ /start
''')
    else:
        contact_id = cb.data.split('_')[1]
        contact = getContactId(contact_id)
        name = contact[1]
        email = contact[2]
        photo = contact[3]
        phone = contact[4]
        job = contact[5]
        msg = f'''
<code>üßø –§–ò–û:</code> {name}
<code>üë®‚Äçüíº –î–æ–ª–∂–Ω–æ—Å—Ç—å:</code> {job}         
<code>üì± –¢–µ–ª–µ—Ñ–æ–Ω:</code> {phone}     
<code>üì© E-mail:</code> {email}'''
        await cb.message.answer_photo(photo, msg, reply_markup=GenContactShowMK(cb.from_user.id, contact_id))


async def delcontact_inline(cb: CallbackQuery):
    username = cb.from_user.username
    if username == None:
        await cb.message.edit_text('''
–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
–ö–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å:
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –ò–∑–º. (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è @username –≤–æ–π–¥–∏—Ç–µ –≤ –±–æ—Ç –ø–æ —Å—Å—ã–ª–∫–µ –µ—â–µ —Ä–∞–∑ –∏ –Ω–∞–∂–º–∏—Ç–µ /start
''')
    else:
        contact_id = cb.data.split('_')[1]
        delContact(contact_id)
        msg = f'''<code>üßø –ö–æ–Ω—Ç–∞–∫—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω:</code>'''
        await cb.message.answer(msg, reply_markup=contactsbacanswerkbtn)


async def contacts_answer(cb: CallbackQuery):
    username = cb.from_user.username
    if username == None:
        await cb.message.edit_text('''
–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!
–ö–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å:
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –ò–∑–º. (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è @username –≤–æ–π–¥–∏—Ç–µ –≤ –±–æ—Ç –ø–æ —Å—Å—ã–ª–∫–µ –µ—â–µ —Ä–∞–∑ –∏ –Ω–∞–∂–º–∏—Ç–µ /start
''')
    else:
        await cb.message.answer('<b>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç:</b>', reply_markup=genContactsList())


def register_contacts(dp: Dispatcher):
    dp.register_callback_query_handler(
        contacts_inline, lambda c: c.data == 'contacntshelpful', state='*')
    dp.register_callback_query_handler(
        contacts_answer, lambda c: c.data == 'contacntshelpfulanswer', state='*')
    dp.register_callback_query_handler(
        showcontact_inline, lambda c: 'showcontacts_' in c.data, state='*')
    dp.register_callback_query_handler(
        delcontact_inline, lambda c: 'delcont_' in c.data, state='*')
